Stochastic
Optimizing Models of Intertemporal Choice

For Dummies!
Christopher Carroll1
1 Johns

Hopkins University and NBER
ccarroll@jhu.edu

June 2012
http://www.econ2.jhu.edu/people/ccarroll/SolvingMicroDSOPs-Slides.pdf

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Efficient Solution Methods for Canonical C problem
CRRA utility
Plausible (microeconomically calibrated) uncertainty
Life cycle or infinite horizon

How To Add a Second Choice Variable
Method of Simulated Moments Estimation of Parameters

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Efficient Solution Methods for Canonical C problem
CRRA utility
Plausible (microeconomically calibrated) uncertainty
Life cycle or infinite horizon

How To Add a Second Choice Variable
Method of Simulated Moments Estimation of Parameters

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Efficient Solution Methods for Canonical C problem
CRRA utility
Plausible (microeconomically calibrated) uncertainty
Life cycle or infinite horizon

How To Add a Second Choice Variable
Method of Simulated Moments Estimation of Parameters

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Efficient Solution Methods for Canonical C problem
CRRA utility
Plausible (microeconomically calibrated) uncertainty
Life cycle or infinite horizon

How To Add a Second Choice Variable
Method of Simulated Moments Estimation of Parameters

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Efficient Solution Methods for Canonical C problem
CRRA utility
Plausible (microeconomically calibrated) uncertainty
Life cycle or infinite horizon

How To Add a Second Choice Variable
Method of Simulated Moments Estimation of Parameters

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Efficient Solution Methods for Canonical C problem
CRRA utility
Plausible (microeconomically calibrated) uncertainty
Life cycle or infinite horizon

How To Add a Second Choice Variable
Method of Simulated Moments Estimation of Parameters

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

The Basic Problem at Date t


max Et 

T
−t
X


inθ u(ct+n ) ,

(1)

nθ =0

yt
Rt =
p t+1 =
log θt+n ∼

R∀t
Γt+1p t

= p t θt

(2)

- constant interest factor = 1 + r
- permanent labor income dynamics(3)

N (−σθ2 /2, σθ2 ) - lognormal transitory shocks ∀ n > 0.

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Bellman Equation

vt (mt , p t ) = max u(ct ) + Et [ivt+1 (mt+1 , p t+1 )]
ct

m −
p −

‘market resources’ (net worth plus current income)
permanent labor income

(4)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Normalize the Problem

vt (mt )

=

max u(ct ) + Et [βΓ1−ρ
t+1 vt+1 (mt+1 )]
ct

(5)

s.t.
at

=

mt − ct

mt+1

=

(R/Γt+1 ) at + θt+1
| {z }
≡Rt+1

where nonbold variables are bold ones normalized by p :
mt

= mt /pp t

(6)

Yields ct (m) from which we can obtain
ct (mt , p t ) = ct (mt /pp t )pp t

(7)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

When Doesn’t Normalization Work?

Non-CRRA utility
Non-Friedman (transitory/permanent) income process
e.g., AR(1)
But micro evidence is consistent with Friedman

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

When Doesn’t Normalization Work?

Non-CRRA utility
Non-Friedman (transitory/permanent) income process
e.g., AR(1)
But micro evidence is consistent with Friedman

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

When Doesn’t Normalization Work?

Non-CRRA utility
Non-Friedman (transitory/permanent) income process
e.g., AR(1)
But micro evidence is consistent with Friedman

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

When Doesn’t Normalization Work?

Non-CRRA utility
Non-Friedman (transitory/permanent) income process
e.g., AR(1)
But micro evidence is consistent with Friedman

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: View Everything from End of Period
Define
vt (at ) = Et [βΓ1−ρ
t+1 vt+1 (Rt+1 at + θt+1 )]

(8)

vt (mt ) = max u(ct ) + vt (mt − ct )

(9)

u 0 (ct ) = v0t (mt − ct ).

(10)

so
ct

with FOC

and Envelope relation
u 0 (ct ) = vt0 (mt )

(11)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Discretize the Risks
E.g. use an equiprobable 7-point distribution:
ℱ
1.
♯n-1
-1
-1
← [θ | ♯n-2
< θ < ♯n-1
]

♯1

[θ | 0 < θ < ♯-1
1 ]→
0.

♯-1
1

-1
♯n-1

θ

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Discretize the Risks

v0t (at )

=

βRΓ−ρ
t+1

 X
n
1
u 0 (ct+1 (Rt+1 at + θi ))
n

(12)

i=1

So for any particular mT −1 the corresponding cT −1 can be found
using the FOC:
u 0 (ct ) = v0t (mt − ct ).

(13)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Discretize the Risks

v0t (at )

=

βRΓ−ρ
t+1

 X
n
1
u 0 (ct+1 (Rt+1 at + θi ))
n

(12)

i=1

So for any particular mT −1 the corresponding cT −1 can be found
using the FOC:
u 0 (ct ) = v0t (mt − ct ).

(13)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Interpolate a Consumption Rule

1
2

~ (indexed m[i])
Define a grid of points m
Use numerical rootfinder to solve u 0 (c) = v0t (m[i] − c)
The c that solves this becomes c[i]

3

Construct interpolating function c̀ by linear interpolation
‘Connect-the-dots’

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Interpolate a Consumption Rule

1
2

~ (indexed m[i])
Define a grid of points m
Use numerical rootfinder to solve u 0 (c) = v0t (m[i] − c)
The c that solves this becomes c[i]

3

Construct interpolating function c̀ by linear interpolation
‘Connect-the-dots’

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Interpolate a Consumption Rule

1
2

~ (indexed m[i])
Define a grid of points m
Use numerical rootfinder to solve u 0 (c) = v0t (m[i] − c)
The c that solves this becomes c[i]

3

Construct interpolating function c̀ by linear interpolation
‘Connect-the-dots’

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Interpolate a Consumption Rule

1
2

~ (indexed m[i])
Define a grid of points m
Use numerical rootfinder to solve u 0 (c) = v0t (m[i] − c)
The c that solves this becomes c[i]

3

Construct interpolating function c̀ by linear interpolation
‘Connect-the-dots’

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Interpolate a Consumption Rule

1
2

~ (indexed m[i])
Define a grid of points m
Use numerical rootfinder to solve u 0 (c) = v0t (m[i] − c)
The c that solves this becomes c[i]

3

Construct interpolating function c̀ by linear interpolation
‘Connect-the-dots’

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Interpolate a Consumption Rule
~ T −1 = {0., 1., 2., 3., 4.} (solid is ‘correct’ soln)
Example: m
cT-1

2.0
1.5
1.0
0.5

1

2

3

4

mT-1

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Problem: Numerical Rootfinding is Slow

Numerical search for values of cT −1 satisfying u 0 (c) = v0t (m[i] − c)
~ T −1 may require hundreds or even
at, say, 6 gridpoints of m
thousands of evaluations of
aT −1

v0T −1 (mT −1
z

}|
{
− cT −1 ) = βT Γ1−ρ
T

 X
n
1
(RT aT −1 + θi )−ρ
n
i=1

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: The Method of Endogenous Gridpoints
Define vector of end-of-period asset values ~a
For each a[j] compute v0t (a[j])
Each of these v0t [j] corresponds to a unique c[j] via FOC:
c[j]−ρ = v0t (a[j])
c[j] =

−1/ρ
v0t (a[j])

(14)
(15)

But the DBC says
at

= mt − ct

m[j] = a[j] + c[j]

(16)
(17)

So computing v0t at a vector of ~a values has produced for us the
~ values at virtually no cost!
corresponding ~c and m
From these we can interpolate as before to construct c̀t (m).

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: The Method of Endogenous Gridpoints
Define vector of end-of-period asset values ~a
For each a[j] compute v0t (a[j])
Each of these v0t [j] corresponds to a unique c[j] via FOC:
c[j]−ρ = v0t (a[j])
c[j] =

−1/ρ
v0t (a[j])

(14)
(15)

But the DBC says
at

= mt − ct

m[j] = a[j] + c[j]

(16)
(17)

So computing v0t at a vector of ~a values has produced for us the
~ values at virtually no cost!
corresponding ~c and m
From these we can interpolate as before to construct c̀t (m).

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: The Method of Endogenous Gridpoints
Define vector of end-of-period asset values ~a
For each a[j] compute v0t (a[j])
Each of these v0t [j] corresponds to a unique c[j] via FOC:
c[j]−ρ = v0t (a[j])
c[j] =

−1/ρ
v0t (a[j])

(14)
(15)

But the DBC says
at

= mt − ct

m[j] = a[j] + c[j]

(16)
(17)

So computing v0t at a vector of ~a values has produced for us the
~ values at virtually no cost!
corresponding ~c and m
From these we can interpolate as before to construct c̀t (m).

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: The Method of Endogenous Gridpoints
Define vector of end-of-period asset values ~a
For each a[j] compute v0t (a[j])
Each of these v0t [j] corresponds to a unique c[j] via FOC:
c[j]−ρ = v0t (a[j])
c[j] =

−1/ρ
v0t (a[j])

(14)
(15)

But the DBC says
at

= mt − ct

m[j] = a[j] + c[j]

(16)
(17)

So computing v0t at a vector of ~a values has produced for us the
~ values at virtually no cost!
corresponding ~c and m
From these we can interpolate as before to construct c̀t (m).

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: The Method of Endogenous Gridpoints
Define vector of end-of-period asset values ~a
For each a[j] compute v0t (a[j])
Each of these v0t [j] corresponds to a unique c[j] via FOC:
c[j]−ρ = v0t (a[j])
c[j] =

−1/ρ
v0t (a[j])

(14)
(15)

But the DBC says
at

= mt − ct

m[j] = a[j] + c[j]

(16)
(17)

So computing v0t at a vector of ~a values has produced for us the
~ values at virtually no cost!
corresponding ~c and m
From these we can interpolate as before to construct c̀t (m).

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: The Method of Endogenous Gridpoints
Define vector of end-of-period asset values ~a
For each a[j] compute v0t (a[j])
Each of these v0t [j] corresponds to a unique c[j] via FOC:
c[j]−ρ = v0t (a[j])
c[j] =

−1/ρ
v0t (a[j])

(14)
(15)

But the DBC says
at

= mt − ct

m[j] = a[j] + c[j]

(16)
(17)

So computing v0t at a vector of ~a values has produced for us the
~ values at virtually no cost!
corresponding ~c and m
From these we can interpolate as before to construct c̀t (m).

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: The Method of Endogenous Gridpoints
Define vector of end-of-period asset values ~a
For each a[j] compute v0t (a[j])
Each of these v0t [j] corresponds to a unique c[j] via FOC:
c[j]−ρ = v0t (a[j])
c[j] =

−1/ρ
v0t (a[j])

(14)
(15)

But the DBC says
at

= mt − ct

m[j] = a[j] + c[j]

(16)
(17)

So computing v0t at a vector of ~a values has produced for us the
~ values at virtually no cost!
corresponding ~c and m
From these we can interpolate as before to construct c̀t (m).

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: The Method of Endogenous Gridpoints
Define vector of end-of-period asset values ~a
For each a[j] compute v0t (a[j])
Each of these v0t [j] corresponds to a unique c[j] via FOC:
c[j]−ρ = v0t (a[j])
c[j] =

−1/ρ
v0t (a[j])

(14)
(15)

But the DBC says
at

= mt − ct

m[j] = a[j] + c[j]

(16)
(17)

So computing v0t at a vector of ~a values has produced for us the
~ values at virtually no cost!
corresponding ~c and m
From these we can interpolate as before to construct c̀t (m).

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Why Directly Approximating vt is a Bad Idea

Principles of Approximation
Hard to approximate things that approach ∞ for relevant m
Not a prob for Rep Agent models: ‘relevant’ m’s are ≈ SS

Hard to approximate things that are highly nonlinear

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Why Directly Approximating vt is a Bad Idea

Principles of Approximation
Hard to approximate things that approach ∞ for relevant m
Not a prob for Rep Agent models: ‘relevant’ m’s are ≈ SS

Hard to approximate things that are highly nonlinear

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Why Directly Approximating vt is a Bad Idea

Principles of Approximation
Hard to approximate things that approach ∞ for relevant m
Not a prob for Rep Agent models: ‘relevant’ m’s are ≈ SS

Hard to approximate things that are highly nonlinear

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Approximate Something That Would Be Linear in PF Case

Perfect Foresight Theory:
ct (m) = (m + ht )κt
for market resources m and end-of-period human wealth h.
This is why it’s a good idea to approximate ct
Bonus: Easy to debug programs by setting σ 2 = 0 and testing
whether numerical solution matches analytical!

(18)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Approximate Something That Would Be Linear in PF Case

Perfect Foresight Theory:
ct (m) = (m + ht )κt
for market resources m and end-of-period human wealth h.
This is why it’s a good idea to approximate ct
Bonus: Easy to debug programs by setting σ 2 = 0 and testing
whether numerical solution matches analytical!

(18)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Approximate Something That Would Be Linear in PF Case

Perfect Foresight Theory:
ct (m) = (m + ht )κt
for market resources m and end-of-period human wealth h.
This is why it’s a good idea to approximate ct
Bonus: Easy to debug programs by setting σ 2 = 0 and testing
whether numerical solution matches analytical!

(18)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

But What if You Need the Value Function?
Perfect foresight value function:
v̄t (mt ) = u(c̄t )CT
t

(19)

=

u(c̄t )κ−1
t

(20)

=

u((Nmt + Nht )κt )κt−1
κ−1
u(Nmt + Nht )κ1−ρ
t
t
−ρ
u(Nmt + Nht )κt

(21)

=
=

where the second line uses the fact demonstrated in Carroll
(Forthcoming) that Ct = κ−1
t .
This can be transformed as
Λ̄t

≡ ((1 − ρ)v̄t )1/(1−ρ)
1/(1−ρ)
= ct (CT
t )
−ρ/(1−ρ)

= (Nmt + Nht )κt
which is linear.

(22)
(23)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

But What if You Need the Value Function?
Perfect foresight value function:
v̄t (mt ) = u(c̄t )CT
t

(19)

=

u(c̄t )κ−1
t

(20)

=

u((Nmt + Nht )κt )κt−1
κ−1
u(Nmt + Nht )κ1−ρ
t
t
−ρ
u(Nmt + Nht )κt

(21)

=
=

where the second line uses the fact demonstrated in Carroll
(Forthcoming) that Ct = κ−1
t .
This can be transformed as
Λ̄t

≡ ((1 − ρ)v̄t )1/(1−ρ)
1/(1−ρ)
= ct (CT
t )
−ρ/(1−ρ)

= (Nmt + Nht )κt
which is linear.

(22)
(23)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Approximate Slope Too

Carroll (Forthcoming) shows that cm
t exists everywhere.
Define consumed function and its derivative as
ct (a) = (v0t (a))−1/ρ

(25)

−1−1/ρ 00
vt (a)
cat (a) = −(1/ρ) v0t (a)

(26)

and using chain rule it is easy to show that
= cat /(1 + cat )
cm
t

(27)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Approximate Slope Too

Carroll (Forthcoming) shows that cm
t exists everywhere.
Define consumed function and its derivative as
ct (a) = (v0t (a))−1/ρ

(25)

−1−1/ρ 00
cat (a) = −(1/ρ) v0t (a)
vt (a)

(26)

and using chain rule it is easy to show that
cm
= cat /(1 + cat )
t

(27)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Approximate Slope Too

Carroll (Forthcoming) shows that cm
t exists everywhere.
Define consumed function and its derivative as
ct (a) = (v0t (a))−1/ρ

(25)

−1−1/ρ 00
cat (a) = −(1/ρ) v0t (a)
vt (a)

(26)

and using chain rule it is easy to show that
cm
= cat /(1 + cat )
t

(27)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

To Implement: Modify Prior Procedures in Two Ways

1
2

Construct ~cm
ct in EGM algorithm
t along with ~
Approximate ct (m) using piecewise Hermite polynomial
Exact match to both level and derivative at set of points

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

To Implement: Modify Prior Procedures in Two Ways

1
2

Construct ~cm
ct in EGM algorithm
t along with ~
Approximate ct (m) using piecewise Hermite polynomial
Exact match to both level and derivative at set of points

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

To Implement: Modify Prior Procedures in Two Ways

1
2

Construct ~cm
ct in EGM algorithm
t along with ~
Approximate ct (m) using piecewise Hermite polynomial
Exact match to both level and derivative at set of points

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Problem: c̀ Below Bottom m Gridpoint and Extrapolation
Consider what happens as aT −1 approaches aT −1 ≡ −θR−1
T ,
lim v0T −1 (a) =

a↓aT −1

lim βRΓ−ρ
T

a↓aT −1

 X
n
1
(aRT + θi )−ρ
n
i=1

= ∞
This means our lowest value in ~aT −1 should be > aT −1 .
Suppose we construct c̀ by linear interpolation:
~ T −1 [1]) + c̀0T −1 (m
~ T −1 [1])(m − m
~ T −1 [1])
c̀T −1 (m) = c̀T −1 (m
True c is strictly concave ⇒ ∃m− > mT −1 for which
m− − c̀T −1 (m− ) < aT −1

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: Hard-Code the Bottom Point
Theory says that
lim

cT −1 (m) = 0

(28)

lim

cm
T −1 (m) = κ̄T −1

(29)

m↓mT −1
m↓mT −1

1

Redefine ~a relative to aT −1

2

~ T −1 and ~cT −1
Construct corresponding m

3

~ T −1
Prepend mT −1 to m

4

Prepend 0. to ~cT −1

5

Prepend κ̄T −1 to ~κT −1

then proceed as before.

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: Hard-Code the Bottom Point
Theory says that
lim

cT −1 (m) = 0

(28)

lim

cm
T −1 (m) = κ̄T −1

(29)

m↓mT −1
m↓mT −1

1

Redefine ~a relative to aT −1

2

~ T −1 and ~cT −1
Construct corresponding m

3

~ T −1
Prepend mT −1 to m

4

Prepend 0. to ~cT −1

5

Prepend κ̄T −1 to ~κT −1

then proceed as before.

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: Hard-Code the Bottom Point
Theory says that
lim

cT −1 (m) = 0

(28)

lim

cm
T −1 (m) = κ̄T −1

(29)

m↓mT −1
m↓mT −1

1

Redefine ~a relative to aT −1

2

~ T −1 and ~cT −1
Construct corresponding m

3

~ T −1
Prepend mT −1 to m

4

Prepend 0. to ~cT −1

5

Prepend κ̄T −1 to ~κT −1

then proceed as before.

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: Hard-Code the Bottom Point
Theory says that
lim

cT −1 (m) = 0

(28)

lim

cm
T −1 (m) = κ̄T −1

(29)

m↓mT −1
m↓mT −1

1

Redefine ~a relative to aT −1

2

~ T −1 and ~cT −1
Construct corresponding m

3

~ T −1
Prepend mT −1 to m

4

Prepend 0. to ~cT −1

5

Prepend κ̄T −1 to ~κT −1

then proceed as before.

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Solution: Hard-Code the Bottom Point
Theory says that
lim

cT −1 (m) = 0

(28)

lim

cm
T −1 (m) = κ̄T −1

(29)

m↓mT −1
m↓mT −1

1

Redefine ~a relative to aT −1

2

~ T −1 and ~cT −1
Construct corresponding m

3

~ T −1
Prepend mT −1 to m

4

Prepend 0. to ~cT −1

5

Prepend κ̄T −1 to ~κT −1

then proceed as before.

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Improving the a Grid
Grid Spacing: Uniform
(T-1 (aT-1 ))-1ρ , T-1 (aT-1 )
5
4
3
2
1
1

2

3

4

aT-1

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Improving the a Grid
Grid Spacing: Same {a, ā} But Triple Exponential e e

e ...

Growth

(T-1 (aT-1 ))-1ρ , T-1 (aT-1 )
5
4
3
2
1
1

2

3

4

aT-1

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

The Method of Moderation

Further improves speed and accuracy of solution
See my talk at the conference!

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

The Method of Moderation

Further improves speed and accuracy of solution
See my talk at the conference!

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Imposing ‘Artificial’ Borrowing Constraints

vT −1 (mT −1 )

=

max u(cT −1 ) + ET −1 [βΓ1−ρ
T vT (mT )]
cT −1

s.t.
aT −1

=

mT −1 − cT −1

mT

=

RT aT −1 + θT

aT −1

≥

0.

Define c̀∗t as soln to unconstrained problem. Then
c̀T −1 (mT −1 ) = min[mT −1 , c̀∗T −1 (mT −1 )].

(30)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Imposing ‘Artificial’ Borrowing Constraints

vT −1 (mT −1 )

=

max u(cT −1 ) + ET −1 [βΓ1−ρ
T vT (mT )]
cT −1

s.t.
aT −1

=

mT −1 − cT −1

mT

=

RT aT −1 + θT

aT −1

≥

0.

Define c̀∗t as soln to unconstrained problem. Then
c̀T −1 (mT −1 ) = min[mT −1 , c̀∗T −1 (mT −1 )].

(30)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Imposing ‘Artificial’ Borrowing Constraints
Point where constraint makes transition from binding to not is
#
0
u 0 (mT
−1 ) = vT −1 (0.)
#
mT
−1 =

v0T −1 (0.)

−1/ρ

Procedure is very easy:
Add 0. as first point in ~a
#
~
⇒ m[1]
= mT
−1
#
Above mT
−1 , c̀T −1 (m) obtained as before
#
Below mT
−1 , c̀T −1 (m) = m

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Imposing ‘Artificial’ Borrowing Constraints
Point where constraint makes transition from binding to not is
#
0
u 0 (mT
−1 ) = vT −1 (0.)
#
mT
−1 =

v0T −1 (0.)

−1/ρ

Procedure is very easy:
Add 0. as first point in ~a
#
~
⇒ m[1]
= mT
−1
#
Above mT
−1 , c̀T −1 (m) obtained as before
#
Below mT
−1 , c̀T −1 (m) = m

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Imposing ‘Artificial’ Borrowing Constraints
Point where constraint makes transition from binding to not is
#
0
u 0 (mT
−1 ) = vT −1 (0.)
#
mT
−1 =

v0T −1 (0.)

−1/ρ

Procedure is very easy:
Add 0. as first point in ~a
#
~
⇒ m[1]
= mT
−1
#
Above mT
−1 , c̀T −1 (m) obtained as before
#
Below mT
−1 , c̀T −1 (m) = m

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Imposing ‘Artificial’ Borrowing Constraints
Point where constraint makes transition from binding to not is
#
0
u 0 (mT
−1 ) = vT −1 (0.)
#
mT
−1 =

v0T −1 (0.)

−1/ρ

Procedure is very easy:
Add 0. as first point in ~a
#
~
⇒ m[1]
= mT
−1
#
Above mT
−1 , c̀T −1 (m) obtained as before
#
Below mT
−1 , c̀T −1 (m) = m

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Imposing ‘Artificial’ Borrowing Constraints
Point where constraint makes transition from binding to not is
#
0
u 0 (mT
−1 ) = vT −1 (0.)
#
mT
−1 =

v0T −1 (0.)

−1/ρ

Procedure is very easy:
Add 0. as first point in ~a
#
~
⇒ m[1]
= mT
−1
#
Above mT
−1 , c̀T −1 (m) obtained as before
#
Below mT
−1 , c̀T −1 (m) = m

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Imposing ‘Artificial’ Borrowing Constraints
cT-1
2.5
2.0
1.5
1.0
0.5

1

2

3

4

mT-1

Figure: Constrained (solid) and Unconstrained (dashed) Consumption

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Recursion: Period t Solution Given Period t + 1

1

Construct
ct,i

−1/ρ
,
(31)
v0t (at,i )

h
i−1/ρ
−ρ
βEt RΓ−ρ
(32)
,
=
t+1 (c̀t+1 (Rt+1 at,i + θt+1 ))
=

2

~ t = ~ct + ~at
Call the result ~ct and generate the corresponding m

3

Interpolate to create c̀t (m)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Recursion: Period t Solution Given Period t + 1

1

Construct
ct,i

−1/ρ
,
(31)
v0t (at,i )

h
i−1/ρ
−ρ
βEt RΓ−ρ
(32)
,
=
t+1 (c̀t+1 (Rt+1 at,i + θt+1 ))
=

2

~ t = ~ct + ~at
Call the result ~ct and generate the corresponding m

3

Interpolate to create c̀t (m)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Recursion: Period t Solution Given Period t + 1

1

Construct
ct,i

−1/ρ
,
(31)
v0t (at,i )

h
i−1/ρ
−ρ
βEt RΓ−ρ
(32)
,
=
t+1 (c̀t+1 (Rt+1 at,i + θt+1 ))
=

2

~ t = ~ct + ~at
Call the result ~ct and generate the corresponding m

3

Interpolate to create c̀t (m)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Consumption Rules c̀T −n Converge
c T-n ()



Figure: Converging c̀T −n (m) Functions for n = {1, 5, 10, 15, 20}

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Portfolio Choice
Now the consumer has a choice between a risky and a safe asset.
The portfolio return is

Rt+1

= R(1 − ςt ) + Rt+1 ςt

(33)

= R + (Rt+1 − R)ςt

(34)

so (setting Γ = 1) the maximization problem is
vt (mt )

Rt+1

=

max

{ct ,ςt }

u(ct ) + βEt [vt+1 (mt+1 )]

s.t.
=

R + (Rt+1 − R)ςt

mt+1

=

(mt − ct )Rt+1 + θt+1

0≤

ςt

≤ 1,

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Portfolio Choice
Now the consumer has a choice between a risky and a safe asset.
The portfolio return is

Rt+1

= R(1 − ςt ) + Rt+1 ςt

(33)

= R + (Rt+1 − R)ςt

(34)

so (setting Γ = 1) the maximization problem is
vt (mt )

Rt+1

=

max

{ct ,ςt }

u(ct ) + βEt [vt+1 (mt+1 )]

s.t.
=

R + (Rt+1 − R)ςt

mt+1

=

(mt − ct )Rt+1 + θt+1

0≤

ςt

≤ 1,

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Portfolio Choice
Now the consumer has a choice between a risky and a safe asset.
The portfolio return is

Rt+1

= R(1 − ςt ) + Rt+1 ςt

(33)

= R + (Rt+1 − R)ςt

(34)

so (setting Γ = 1) the maximization problem is
vt (mt )

Rt+1

=

max

{ct ,ςt }

u(ct ) + βEt [vt+1 (mt+1 )]

s.t.
=

R + (Rt+1 − R)ςt

mt+1

=

(mt − ct )Rt+1 + θt+1

0≤

ςt

≤ 1,

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Portfolio Choice
Now the consumer has a choice between a risky and a safe asset.
The portfolio return is

Rt+1

= R(1 − ςt ) + Rt+1 ςt

(33)

= R + (Rt+1 − R)ςt

(34)

so (setting Γ = 1) the maximization problem is
vt (mt )

Rt+1

=

max

{ct ,ςt }

u(ct ) + βEt [vt+1 (mt+1 )]

s.t.
=

R + (Rt+1 − R)ςt

mt+1

=

(mt − ct )Rt+1 + θt+1

0≤

ςt

≤ 1,

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Portfolio Choice

The FOC with respect to ct now yields an Euler equation
u 0 (ct ) = Et [β Rt+1 u 0 (ct+1 )].

(35)

while the FOC with respect to the portfolio share yields
0
0 = Et [vt+1
(mt+1 )(Rt+1 − R)at ]
 0

= at Et u (ct+1 (mt+1 )) (Rt+1 − R) .

(36)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Portfolio Choice

The FOC with respect to ct now yields an Euler equation
u 0 (ct ) = Et [β Rt+1 u 0 (ct+1 )].

(35)

while the FOC with respect to the portfolio share yields
0
0 = Et [vt+1
(mt+1 )(Rt+1 − R)at ]
 0

= at Et u (ct+1 (mt+1 )) (Rt+1 − R) .

(36)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Convergence

When the problem satisfies certain conditions (Carroll
(Forthcoming)), it defines a ‘converged’ consumption rule with a
‘target’ ratio m̌ that satisfies:
Et [mt+1 /mt ] = 1 if mt = m̌

(37)

Define the target m implied by the consumption rule ct as m̌t .
Then a plausible metric for convergence is to define some value 
and to declare the solution to have converged when
|m̌t+1 − m̌t | < 

(38)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Convergence

When the problem satisfies certain conditions (Carroll
(Forthcoming)), it defines a ‘converged’ consumption rule with a
‘target’ ratio m̌ that satisfies:
Et [mt+1 /mt ] = 1 if mt = m̌

(37)

Define the target m implied by the consumption rule ct as m̌t .
Then a plausible metric for convergence is to define some value 
and to declare the solution to have converged when
|m̌t+1 − m̌t | < 

(38)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Convergence

When the problem satisfies certain conditions (Carroll
(Forthcoming)), it defines a ‘converged’ consumption rule with a
‘target’ ratio m̌ that satisfies:
Et [mt+1 /mt ] = 1 if mt = m̌

(37)

Define the target m implied by the consumption rule ct as m̌t .
Then a plausible metric for convergence is to define some value 
and to declare the solution to have converged when
|m̌t+1 − m̌t | < 

(38)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine θ

1

Start with coarse grid for θ (say, 3 points)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for θ (say, 7 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine θ

1

Start with coarse grid for θ (say, 3 points)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for θ (say, 7 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine θ

1

Start with coarse grid for θ (say, 3 points)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for θ (say, 7 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine θ

1

Start with coarse grid for θ (say, 3 points)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for θ (say, 7 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine θ

1

Start with coarse grid for θ (say, 3 points)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for θ (say, 7 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine ~aT −1

1

Start with coarse grid for ~a (say, 5 gridpoints)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for ~a (say, 20 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine ~aT −1

1

Start with coarse grid for ~a (say, 5 gridpoints)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for ~a (say, 20 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine ~aT −1

1

Start with coarse grid for ~a (say, 5 gridpoints)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for ~a (say, 20 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine ~aT −1

1

Start with coarse grid for ~a (say, 5 gridpoints)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for ~a (say, 20 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Trick: Coarse then Fine ~aT −1

1

Start with coarse grid for ~a (say, 5 gridpoints)

2

Solve to convergence; call period of convergence n

3

Construct finer grid for ~a (say, 20 points)

4

Solve for period T − n − 1 assuming c̀T −n

5

Continue to convergence

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Life Cycle Maximization Problem

vt (mt )

=

n
o
max u(ct ) + iℵt+1 β̂t+1 Et [(ψt+1 Γt+1 )1−ρ vt+1 (mt+1 )]
ct

s.t.
at

=

mt+1

=

mt − ct


R
at
+θt+1
ψt+1 Γt+1
|
{z
}
≡Rt+1

ℵs

: probability alive (not dead) until age s given alive at age s − 1

β̂s

: time-varying discount factor between age s − 1 and s

Ψs

: mean-one shock to permanent income

i : time-invariant discount factor

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Details follow Cagetti (2003)

Parameterization of Uncertainty
Probability of Death
Demographic Adjustments to β

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Details follow Cagetti (2003)

Parameterization of Uncertainty
Probability of Death
Demographic Adjustments to β

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Details follow Cagetti (2003)

Parameterization of Uncertainty
Probability of Death
Demographic Adjustments to β

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Empirical Wealth Profiles

10
8
6
4
2
Age
26-30

26-30

36-40

41-45

46-50

51-55

56-60

Figure: m from SCF (means (dashed) and medians (solid))

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Simulated Moments

Given a set of parameter values {ρ, i}:
Start at age 25 with empirical m data
Draw shocks using calibrated σψ2 ,σθ2
Consume according to solved ct
⇒ m distribution by age

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Simulated Moments

Given a set of parameter values {ρ, i}:
Start at age 25 with empirical m data
Draw shocks using calibrated σψ2 ,σθ2
Consume according to solved ct
⇒ m distribution by age

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Simulated Moments

Given a set of parameter values {ρ, i}:
Start at age 25 with empirical m data
Draw shocks using calibrated σψ2 ,σθ2
Consume according to solved ct
⇒ m distribution by age

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Simulated Moments

Given a set of parameter values {ρ, i}:
Start at age 25 with empirical m data
Draw shocks using calibrated σψ2 ,σθ2
Consume according to solved ct
⇒ m distribution by age

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Simulated Moments

Given a set of parameter values {ρ, i}:
Start at age 25 with empirical m data
Draw shocks using calibrated σψ2 ,σθ2
Consume according to solved ct
⇒ m distribution by age

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Choose What to Simulate

GapEmpiricalSimulatedMedians[ρ, i]:=
[

ConstructcFuncLife[ρ, i];
Simulate;
N
X
ωi |ςiτ − sτ (ξ)|
i

];

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Calculate Match Between Theory and Data

ξ = {ρ, i}
solve
min
ξ

N
X
i

ωi |ςiτ − sτ (ξ)|

(39)

(40)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Bootstrap Standard Errors (Horowitz (2001))

Yields estimates of
Table: Estimation Results

ρ
4.68
(0.13)

i
1.00
(0.00)

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

Contour Plot
1.05

1.00

0.95

0.90

0.85
2

3

4

5

6

7

8

Figure: Point Estimate and Height of Minimized Function

Introduction The Problem Tricks

Multiple Control Variables The Infinite Horizon Structural Estimat

References I

Cagetti, Marco (2003): “Wealth Accumulation Over the Life Cycle and Precautionary Savings,” Journal of
Business and Economic Statistics, 21(3), 339–353.
Carroll, Christopher D. (Forthcoming): “Theoretical Foundations of Buffer Stock Saving,” Quantitative
Economics.
Horowitz, Joel L. (2001): “The Bootstrap,” in Handbook of Econometrics, ed. by James J. Heckman, and
Edward Leamer, vol. 5. Elsevier/North Holland.

